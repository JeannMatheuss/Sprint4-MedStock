-- Tabela USUARIO
CREATE TABLE USUARIO (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NOME VARCHAR2(255) NOT NULL,
    LOGIN VARCHAR2(100) UNIQUE NOT NULL,
    SENHA VARCHAR2(100) NOT NULL,  -- Em produção, use hash (ex: BCrypt)
    PERFIL VARCHAR2(50) NOT NULL CHECK (PERFIL IN ('ADMIN', 'OPERADOR'))
);

-- Índice para buscas rápidas por login
CREATE INDEX IDX_USUARIO_LOGIN ON USUARIO(LOGIN);

-- Tabela MATERIAL
CREATE TABLE MATERIAL (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NOME VARCHAR2(255) NOT NULL,
    QUANTIDADE NUMBER(10,2) DEFAULT 0 NOT NULL CHECK (QUANTIDADE >= 0),
    UNIDADE VARCHAR2(20) NOT NULL,
    PONTO_REPOSICAO NUMBER(10,2) DEFAULT 0 NOT NULL CHECK (PONTO_REPOSICAO >= 0)
);

-- Índice para buscas por nome
CREATE INDEX IDX_MATERIAL_NOME ON MATERIAL(NOME);

-- Tabela MOVIMENTACAO (entradas/saídas)
CREATE TABLE MOVIMENTACAO (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    MATERIAL_ID NUMBER NOT NULL,
    USUARIO_ID NUMBER NOT NULL,
    TIPO VARCHAR2(20) NOT NULL CHECK (TIPO IN ('ENTRADA', 'SAIDA')),
    QUANTIDADE NUMBER(10,2) DEFAULT 0 NOT NULL CHECK (QUANTIDADE > 0),
    DATA_MOVIMENTACAO TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_MOV_MATERIAL FOREIGN KEY (MATERIAL_ID) REFERENCES MATERIAL(ID) ON DELETE CASCADE,
    CONSTRAINT FK_MOV_USUARIO FOREIGN KEY (USUARIO_ID) REFERENCES USUARIO(ID) ON DELETE CASCADE
);

-- Tabela CONSUMO (opcional, baseada no seu código; aponte consumos por material)
CREATE TABLE CONSUMO (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    MATERIAL_ID NUMBER NOT NULL,
    QUANTIDADE NUMBER(10,2) DEFAULT 0 NOT NULL CHECK (QUANTIDADE > 0),
    DATA_APONTAMENTO TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    RESPONSAVEL VARCHAR2(255) NOT NULL,
    CONSTRAINT FK_CONS_MATERIAL FOREIGN KEY (MATERIAL_ID) REFERENCES MATERIAL(ID) ON DELETE CASCADE
);
-- Criação da tabela de usuários
CREATE TABLE USUARIO (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NOME VARCHAR2(100) NOT NULL,
    LOGIN VARCHAR2(50) UNIQUE NOT NULL,
    SENHA VARCHAR2(100) NOT NULL,
    PERFIL VARCHAR2(20) DEFAULT 'OPERADOR' NOT NULL
);

-- Criação da tabela de materiais
CREATE TABLE MATERIAL (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NOME VARCHAR2(200) NOT NULL,
    QUANTIDADE NUMBER DEFAULT 0 NOT NULL,
    UNIDADE VARCHAR2(20) NOT NULL,
    PONTO_REPOSICAO NUMBER DEFAULT 0 NOT NULL
);

-- Movimentações de estoque (entradas/saídas)
CREATE TABLE MOVIMENTACAO (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    MATERIAL_ID NUMBER NOT NULL,
    USUARIO_ID NUMBER NOT NULL,
    TIPO VARCHAR2(20) CHECK (TIPO IN ('ENTRADA','SAIDA')) NOT NULL,
    QUANTIDADE NUMBER NOT NULL,
    DATA_MOVIMENTACAO TIMESTAMP DEFAULT SYSTIMESTAMP,
    CONSTRAINT FK_MOV_MATERIAL FOREIGN KEY (MATERIAL_ID) REFERENCES MATERIAL(ID),
    CONSTRAINT FK_MOV_USUARIO FOREIGN KEY (USUARIO_ID) REFERENCES USUARIO(ID)
);

-- Consumos (apontamentos diretos de uso de material)
CREATE TABLE CONSUMO (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    MATERIAL_ID NUMBER NOT NULL,
    QUANTIDADE NUMBER NOT NULL,
    DATA_APONTAMENTO TIMESTAMP DEFAULT SYSTIMESTAMP,
    RESPONSAVEL VARCHAR2(100),
    CONSTRAINT FK_CONSUMO_MATERIAL FOREIGN KEY (MATERIAL_ID) REFERENCES MATERIAL(ID)
);

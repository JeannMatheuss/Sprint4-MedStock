-- Tabela USUARIO
CREATE TABLE USUARIO (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NOME VARCHAR2(255) NOT NULL,
    LOGIN VARCHAR2(100) UNIQUE NOT NULL,
    SENHA VARCHAR2(100) NOT NULL,
    PERFIL VARCHAR2(50) NOT NULL CHECK (PERFIL IN ('ADMIN', 'OPERADOR'))
);

CREATE INDEX IDX_USUARIO_LOGIN ON USUARIO(LOGIN);

-- Tabela MATERIAL
CREATE TABLE MATERIAL (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NOME VARCHAR2(255) NOT NULL,
    QUANTIDADE NUMBER(10,2) DEFAULT 0 NOT NULL CHECK (QUANTIDADE >= 0),
    UNIDADE VARCHAR2(20) NOT NULL,
    PONTO_REPOSICAO NUMBER(10,2) DEFAULT 0 NOT NULL CHECK (PONTO_REPOSICAO >= 0)
);

CREATE INDEX IDX_MATERIAL_NOME ON MATERIAL(NOME);

-- Tabela MOVIMENTACAO
CREATE TABLE MOVIMENTACAO (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ID_MATERIAL NUMBER NOT NULL,
    ID_USUARIO NUMBER NOT NULL,
    QUANTIDADE NUMBER(10,2) DEFAULT 0 NOT NULL CHECK (QUANTIDADE > 0),
    TIPO VARCHAR2(20) NOT NULL CHECK (TIPO IN ('ENTRADA', 'SAIDA')),
    DATA_HORA TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_MOV_MATERIAL FOREIGN KEY (ID_MATERIAL) REFERENCES MATERIAL(ID) ON DELETE CASCADE,
    CONSTRAINT FK_MOV_USUARIO FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID) ON DELETE CASCADE
);

-- Tabela CONSUMO
CREATE TABLE CONSUMO (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ID_MATERIAL NUMBER NOT NULL,
    QUANTIDADE NUMBER(10,2) DEFAULT 0 NOT NULL CHECK (QUANTIDADE > 0),
    DATA_APONTAMENTO TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    RESPONSAVEL VARCHAR2(255) NOT NULL,
    CONSTRAINT FK_CONS_MATERIAL FOREIGN KEY (ID_MATERIAL) REFERENCES MATERIAL(ID) ON DELETE CASCADE
);
